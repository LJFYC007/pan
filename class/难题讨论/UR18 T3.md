# UR18 T3 在路上了

cdqz-yk



交互题



有一张$n$个点的完全图。你不知道他长什么样子。每条边是红色或者蓝色。已知对于所有$1\le i<k$，连接$i$和$i+1$的连边是红色。你需要找到一条$k+1$个点的路径，满足所有边的颜色相同。

$1\le k\le 2000, \frac{3k}{2}\le n\le 2k$。

1. $n = 2k, Q = 4k$
2. $Q = 2k$

## sol

思路来自Jerome_wei



先考虑一下$n = 2k$应该怎么做。



考虑两个点$p,q$，如果这两个点之间是蓝边直接连上去，如果是红边我们就可以在$[1,k]$中找两个点$[a,a+1]$，并且查询4次$p,q$和$a,a+1$之间的边，不难发现一定存在一条蓝边的路径形如$p\rightarrow (a/a+1)\rightarrow q$，如果不满足只有可能有两个情况：

1. $p,q$中至少有一个和$a,a+1$全部都是红边连接。
2. $p,q$分别和$a,a+1$连接。

因为$p,q$之间本身是红边，所以这两种情况很明显都可以直接输出一个红边组成的路径。查询次数是$4k$。并且消耗两个链上点会让答案的链长度加二，所以在$n = 2k$的时候一定是可以构造的。



考虑这样做的弊端，因为最劣情况下路径的节点编号全部大于k，所以说有可能导致长度不够。考虑如何优化才能保证找到一条长度足够的边。因为不在$[1,k]$中的点只有$\frac{k}{2}$个，所以我们要能保证任意两个点之间插的进去一个$[1,k]$中的点。



考虑优化，我们维护由非链点构成的两条链，然后每次用这两条链的端点$a,b$和另外一个链外的点$c$来进行构造。对于这三个点和链上两个相邻点$x,x+1$不难发现一定存在$a\rightarrow (x/x+1)\rightarrow c$或者$b\rightarrow (x/x+1)\rightarrow c$否则就可以直接找到红链了。即我们可以一直这样进行构造直到非链点只剩下两条链。



不妨设非链点有$m = n - k$个，那么一共连了$m - 2$条边，消耗了链上点$2(m-2)$个。当$m = k$时这时候链上只能剩下$4$个点，我们保留第一个和最后一个，即两个端点。因为这两个点一定是不会和任何节点有红色边的。



我们可以用一个端点把两条链连接在一起，这个时候连在一起的链长度是$2m - 1$，再将另一个端点接在这个链后面，链的长度就变成了$2m$。然后我们还剩下两个相邻的非端点。并且这个时候答案链的最前面点是非链点，所以说一定可以加上去一条边。这样长度就变成$2m+1\ge k+1$了。即完成了构造。



考虑这样查询的次数，因为是每3个点查询6次，所以说总的次数是$\frac{k}{2}*2*3 = 3k$。考虑如何优化：可以先查询$a\rightarrow x, b\rightarrow x$，如果同色，那么最多只会多花两次查询找到合法的点，否则可以查询$c\rightarrow x+1$，之后无论如何只会查询一次了。那么这样每3个点只会查询4次，所以就优化到了$2k$次。